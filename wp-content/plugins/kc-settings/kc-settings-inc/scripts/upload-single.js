var win=window.dialogArguments||opener||parent||top;(function(b){b.fn.kcsfsPrepare=function(d,c){return this.each(function(){var e=b(this),g=e.children();if(!g.length){return}var f=win.kcSettings.upload.target.find("input").val();g.each(function(){var i=b(this);if(i.find("a.kc-select").length){return}var h=d?c:i.attr("id").split("-")[2];if(h===f){return}var k=i.find("img.pinkynail").attr("src"),l=i.find(".title").text(),j=i.find("#type-of-"+h).val();b('<a href="#" class="kc-select" data-id="'+h+'" data-img="'+k+'" data-title="'+l+'" data-type="'+j+'">'+win.kcSettings.upload.text.selFile+"</a>").on("click",a).prependTo(i.children(".new"))})})};var a=function(c){c.preventDefault();win.kcFileSingle(b(c.delegateTarget).data());win.tb_remove()};b(document).ready(function(c){c("#library-form, #gallery-form").find("#media-items").kcsfsPrepare(false);c("#media-upload").ajaxComplete(function(f,g,d){if(g.status!==200||d.url!=="async-upload.php"){return}c("#media-items",this).kcsfsPrepare(true,g.responseText.match(/type-of-(\d+)/)[1])})})})(jQuery);