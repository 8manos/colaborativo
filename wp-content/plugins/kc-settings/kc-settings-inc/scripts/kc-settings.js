var win=window.dialogArguments||opener||parent||top,h5_details=false;(function(a){win.kcFileMultiple=function(f){var b=win.kcSettings.upload.target,g=b.data("currentFiles"),d=b.children().last(),h=a(),c=null;for(var e in f){if(!f.hasOwnProperty(e)||a.inArray(f[e].id,g)>-1){continue}c=d.clone().removeClass("hidden");c.find("img").attr("src",f[e].img);c.find("input").val(f[e].id).prop("checked",false);c.find(".title").text(f[e].title);h=h.add(c)}b.append(h);if(d.is(".hidden")){h.show();d.remove()}b.show().prev(".info").show()};win.kcFileSingle=function(f){var b=win.kcSettings.upload.target,e=b.find("span").text(f.title),d=b.find("img").attr("src",f.img);b.removeAttr("data-type");b.find("input").val(f.id);b.children("a.up").hide();b.find("p").fadeIn().children("a.up").show().siblings("a.rm").show();if(f.type=="image"){b.attr("data-type",f.type);e.hide();var c=b.data("size");if(c!=="thumbnail"){a.ajax({type:"POST",url:ajaxurl,data:{action:"kc_get_image_url",id:f.id,size:c},success:function(g){if(g){d.attr("src",g)}}})}}else{e.show()}}})(jQuery);jQuery(document).ready(function(g){var e=g("body"),o=g("#kcsb"),h=g("form.kcsb"),c=g("#kc-settings-form");var j={sortable:{axis:"y",start:function(p,q){q.placeholder.height(q.item.outerHeight())},stop:function(p,q){q.item.parent().kcReorder(q.item.data("mode"),true).children().each(function(){g("> details > summary > .actions .count",this).text(g(this).index()+1)})}},colorpicker:{onBeforeShow:function(){g(this).ColorPickerSetColor(this.value)},onSubmit:function(p,t,r,s){var q="#"+t;g(s).css({backgroundColor:q,color:invertColor(q)}).val(q).ColorPickerHide()}},datepicker:{date:{dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,showButtonPanel:true},month:{changeMonth:true,changeYear:true,showButtonPanel:true,dateFormat:"yy-mm",onClose:function(t,r){var p=g(r.dpDiv),s=p.find(".ui-datepicker-month :selected").val(),q=p.find(".ui-datepicker-year :selected").val();g(this).datepicker("setDate",new Date(q,s,1))}}}};if(g.fn.details.support){g("html").addClass("details");h5_details=true}else{g("html").addClass("no-details");g("details").details()}if(c.length){var f=c.find("div.metabox-holder");if(f.length){var b=f.attr("id"),m=c.find(":checkbox");if(m.length){var n=g();m.each(function(){var r=g("#"+b+"-"+this.value);if(!r.length){return}var q=g(this),p=g("#"+b+"-"+this.value+"-hide");q.data("sectHider",p).data("sectBox",r);if(!(this.checked===p[0].checked)){p.prop("checked",this.checked).triggerHandler("click")}n=n.add(q)});if(n.length){n.change(function(){var p=g(this);p.data("sectHider").prop("checked",this.checked).triggerHandler("click");if(this.checked){p.data("sectBox").kcGoto({offset:-40,speed:"slow"})}})}}}}g("ul.kc-rows").sortable(j.sortable);e.on("click",".row a.del",function(s){s.preventDefault();var p=g(this).closest(".row");if(!p.siblings(".row").length){return}var q=p.parent(),t=p.data("mode"),r=p.is(":last-child");p.addClass("removing").fadeOut("slow",function(){p.remove();if(!r){q.kcReorder(t,true);if(h.length){q.children().each(function(){g("> details > summary > .actions .count",this).text(g(this).index()+1)})}}})});e.on("click",".row a.add",function(v){v.preventDefault();var y=g(this),x=y.closest(".row"),q=x.parent(),u=x.data("mode"),r=x.is(":last-child"),s=x.clone(false).addClass("adding"),w=false,p=400;if(u=="sections"){w=true;p=1200}else{if(u=="fields"){w=true;p=800}}if(h.length){s.find(".kc-rows").each(function(){g(this).children(".row").not(":first").remove()});s.find(":input").each(function(){var z=g(this);if(this.type=="text"||this.type=="textarea"){z.removeAttr("style").val("")}else{if(this.type=="checkbox"||this.type=="radio"){z.prop("checked",this.checked)}}if(z.is(".kcsb-ids")){z.kcsbUnique()}})}else{s.find(":input").each(function(){var z=g(this);if(z.data("nocleanup")!==true){z.val("")}})}g("ul.kc-rows").sortable(j.sortable);g(".hasdep",s).kcFormDep();g(".hasDatepicker",s).each(function(){g(this).removeClass("hasDatepicker").removeAttr("id").datepicker(j.datepicker[g(this).attr("type")])});g(".hasColorpicker",s).removeAttr("style").ColorPicker(j.colorpicker);var t=g("details",s).details();if(!h5_details){t.children().not("summary").hide()}x.after(s);if(w){s.kcGoto({offset:-100,speed:p})}setTimeout(function(){s.removeClass("adding")},p);q.kcReorder(u,true);if(h.length){if(r){g("> details > summary > .actions .count",s).text(s.index()+1)}else{q.children().each(function(){g("> details > summary > .actions .count",this).text(g(this).index()+1)})}}if(!h5_details){t.first().not(".open").stop().children("summary").trigger("click")}});e.on("click",".row a.clear",function(p){p.preventDefault();g(this).closest(".row").find(":input").val("")});var a=g("input[type=date], input[type=month]");if(a.length&&Modernizr.inputtypes.date===false){var i=g("body").is(".admin-color-classic")?"cupertino":"flick";Modernizr.load([{load:win.kcSettings.paths.styles+"/jquery-ui/"+i+"/style.css",complete:function(){a.each(function(){g(this).datepicker(j.datepicker[g(this).attr("type")])})}}])}var l=g("input[type=color]");if(l.length&&Modernizr.inputtypes.color===false){Modernizr.load([{load:[win.kcSettings.paths.scripts+"/colorpicker/js/colorpicker.js",win.kcSettings.paths.scripts+"/colorpicker/css/colorpicker.css",win.kcSettings.paths.scripts+"/rgbcolor.js"],complete:function(){l.ColorPicker(j.colorpicker).each(function(){var p=g(this).addClass("hasColorpicker");if(p.val()!==""){p.css({backgroundColor:this.value,color:invertColor(this.value)})}})}}])}e.on("click",".kcs-file a.rm",function(q){q.preventDefault();var p=g(this).closest(".row");p.addClass("removing").fadeOut("slow",function(){if(p.siblings().length){p.remove()}else{p.removeClass("removing").addClass("hidden").find(":input").val("").prop("checked",false);g("input.fileID",p).prop("disabled",true);p.parent().hide().prev(".info").hide()}})});e.on("click","a.kcsf-upload",function(t){t.preventDefault();var r=g(this),p=r.siblings(".kc-rows"),q=p.find(".row.hidden"),s=[];if(q.length){g("input.fileID",q).prop("disabled",false)}else{g("input.fileID",p).each(function(){s.push(this.value)})}win.kcSettings.upload.target=p.data("currentFiles",s);tb_show("",r.attr("href"))});e.on("click",".kcs-file-single a.rm",function(p){p.preventDefault();g(this).fadeOut().closest("div").find("p.current").fadeOut(function(){g(this).siblings("a.up").show().siblings("input").val("")})});e.on("click",".kcs-file-single a.up",function(q){q.preventDefault();var p=g(this);win.kcSettings.upload.target=p.closest("div");tb_show("",p.attr("href"))});g("a.kc-help-trigger").on("click",function(p){p.preventDefault();g("#contextual-help-link").click();g("#screen-meta").kcGoto()});g(".kcs-tabs").kcTabs();var k=g("#addtag");if(k.length){var d=g();g("div.kcs-field").each(function(){d=d.add(g(this).clone())});if(d.length){k.ajaxComplete(function(q,r,p){if(p.data.indexOf("action=add-tag")<0){return}g("div.kcs-field").each(function(s){g(this).replaceWith(d.eq(s).clone())});g(".kcs-tabs",k).kcTabs();k.trigger("kcsRefreshed")})}}if(o.length){if(!o.is(".hidden")){o.kcGoto()}g(".hasdep",o).kcFormDep();e.on("blur","input.kcsb-slug",function(){var p=g(this);p.val(kcsbSlug(p.val()))});g("input.kcsb-ids").kcsbUnique();e.on("blur","input.required, input.clone-id",function(){g(this).kcsbCheck()});g("#new-kcsb").on("click",function(p){p.preventDefault();o.kcGoto()});g("a.kcsb-cancel").on("click",function(p){p.preventDefault();g("#kcsb").slideUp("slow")});g("a.clone-open").on("click",function(p){p.preventDefault();g(this).parent().children().hide().filter("div.kcsb-clone").fadeIn(function(){g(this).find("input.clone-id").focus()})});g("a.clone-do").on("click",function(q){var p=g(this),r=g(this).siblings("input");if(r.kcsbCheck()===false){return false}p.attr("href",p.attr("href")+"&new="+r.val())});g("input.clone-id").on("keypress",function(q){var p=q.keyCode||q.which;if(p===13){q.preventDefault();g(this).blur().siblings("a.clone-do").click()}});g(".kcsb-tools a.close").on("click",function(q){q.preventDefault();var p=g(this);p.siblings("input").val("");p.parent().fadeOut(function(){g(this).siblings().show()})});h.submit(function(q){var p=true;g(this).find("input.required").not(":disabled").each(function(){if(g(this).kcsbCheck()===false){p=false;return false}});if(!p){return false}})}});